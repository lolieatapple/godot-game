# 游戏功能实现文档

## 已完成功能清单

### 1. 玩家系统 (Player.gd / Player.tscn)
- **移动系统**：WASD 控制，对角线移动速度归一化
- **射击系统**：鼠标瞄准，左键射击，带冷却时间 (0.2秒)
- **生命系统**：100点生命值，实时更新UI
- **受伤反馈**：
  - 相机剧烈震动（强度8.0，持续0.3秒）
  - 全屏红色遮罩渐隐效果
- **死亡机制**：生命值为0时重载场景
- **动画系统**：优先级 shoot > walk > idle

**可调参数**：
- `speed: 300.0` - 移动速度
- `shoot_cooldown: 0.2` - 射击冷却
- `max_health: 100.0` - 最大生命值

### 2. 敌人AI系统 (Zombie.gd / Zombie.tscn)
- **寻路系统**：自动追踪玩家位置
- **攻击系统**：
  - 进入攻击范围（20单位）时停止并攻击
  - 攻击冷却时间1秒
  - 每次攻击造成10点伤害
- **击杀奖励**：死亡时发送信号，奖励10分

**可调参数**：
- `speed: 150.0` - 移动速度
- `attack_range: 20.0` - 攻击范围
- `damage: 10.0` - 攻击伤害
- `attack_cooldown: 1.0` - 攻击冷却
- `score_value: 10` - 击杀得分

### 3. 子弹系统 (Bullet.gd / Bullet.tscn)
- **直线飞行**：固定速度600单位/秒
- **碰撞检测**：
  - 击中僵尸：调用 `die()` 方法触发击杀奖励
  - 击中墙壁：直接销毁
- **自动清理**：离开屏幕时销毁

**可调参数**：
- `speed: 600.0` - 飞行速度

### 4. 敌人生成系统 (EnemySpawner.gd)
- **定时生成**：每2秒生成一个僵尸
- **智能定位**：
  - 在玩家周围500-600单位的环形区域生成
  - 检测碰撞，避免生成在墙内
  - 最多尝试10次寻找有效位置
- **自动连接**：生成的僵尸自动加入场景

**可调参数**：
- `spawn_interval: 2.0` - 生成间隔
- `spawn_distance_min: 500.0` - 最小生成距离
- `spawn_distance_max: 600.0` - 最大生成距离
- `max_spawn_attempts: 10` - 最大尝试次数

### 5. 相机震动系统 (CameraShake.gd)
- **双触发场景**：
  - 射击时：轻微震动（强度3.0，时长0.1秒）
  - 受伤时：剧烈震动（强度8.0，时长0.3秒）
- **渐减效果**：震动强度随时间线性衰减

### 6. UI系统 (GameUI.gd / GameUI.tscn)
- **生命条**：
  - 实时显示当前/最大生命值
  - 颜色变化：绿色(>60%) → 黄色(>30%) → 红色(≤30%)
- **分数显示**：击杀僵尸累计得分
- **伤害遮罩**：受伤时全屏红色遮罩渐隐
- **动态连接**：自动连接新生成僵尸的死亡信号

**可调参数**：
- `damage_fade_speed: 2.0` - 伤害遮罩渐隐速度

### 7. 暂停菜单系统 (PauseMenu.gd / PauseMenu.tscn)
- **暂停/继续**：按 ESC 键切换暂停状态
- **重新开始**：从暂停菜单重启游戏
- **退出游戏**：退出到桌面
- **暂停时冻结**：使用 `process_mode = 3` 确保暂停菜单不受影响
- **UI 显示**：半透明背景面板，居中菜单

**按键**：
- `ESC` - 打开/关闭暂停菜单
- 暂停时游戏完全冻结（僵尸、玩家、计时器等）

### 8. 地图系统 (Main.tscn)
- **地板层**：使用 TileMapLayer
- **墙体层**：3格厚墙体，带碰撞检测
- **物理层配置**：
  - Layer 1: 墙体/静态物体
  - Layer 2: 子弹
  - Layer 3: 僵尸
  - Layer 4: 玩家

### 9. 墙体生成工具 (WallGenerator.gd)
- **智能分析**：自动识别现有墙体样式
- **多种形状**：水平、垂直、L形、U形墙
- **厚度控制**：墙体厚度3格
- **密集生成**：
  - 一次生成25组墙
  - 墙长度5-15格
  - 在距中心12-45单位的环形区域生成
  - 最小墙间距2格

**使用方法**：
1. 在 Godot 编辑器中打开 Main.tscn
2. 菜单：File → Run Script → WallGenerator.gd
3. 保存场景 (Ctrl+S)

**可调参数**：
- `num_wall_groups: 25` - 生成墙组数量
- `wall_thickness: 3` - 墙体厚度
- `min_wall_length: 5` - 最小墙长
- `max_wall_length: 15` - 最大墙长

## 信号系统架构

### 玩家 → GameUI
```gdscript
signal health_changed(new_health: float, max_health: float)
```
用途：更新生命条显示

### 僵尸 → GameUI
```gdscript
signal zombie_killed(points: int)
```
用途：增加分数

### GameUI 监听
- `node_added` 树信号：自动连接新生成僵尸

## 节点组 (Groups)
- `"Player"` - 玩家角色（僵尸和UI用于查找）
- `"Zombie"` - 僵尸敌人（子弹用于检测击中）
- `"GameUI"` - UI系统（玩家用于触发伤害效果）

## 输入映射 (project.godot)
- `move_left` - A键 (物理键码65)
- `move_right` - D键 (物理键码68)
- `move_up` - W键 (物理键码87)
- `move_down` - S键 (物理键码83)
- `ui_cancel` - ESC键 (物理键码4194305) - 暂停菜单
- 射击 - 鼠标左键 (代码直接检测)

## 物理层设置

| 层 | 名称 | 用途 |
|---|---|---|
| 1 | 墙体 | 静态碰撞体（墙、障碍物） |
| 2 | 子弹 | 子弹碰撞层 |
| 3 | 僵尸 | 僵尸碰撞层 |
| 4 | 玩家 | 玩家碰撞层 |

**碰撞检测**：
- 子弹 → 墙体 + 僵尸 (collision_mask = 5)
- 僵尸 → 墙体 + 玩家 (collision_mask = 5)
- 玩家 → 墙体 (collision_mask = 1)

## 核心文件结构

```
├── Main.tscn              # 主场景（包含地图、玩家、生成器、UI）
├── Player.gd/tscn         # 玩家系统
├── Zombie.gd/tscn         # 僵尸AI
├── Bullet.gd/tscn         # 子弹
├── EnemySpawner.gd        # 敌人生成器（无scene）
├── CameraShake.gd         # 相机震动脚本（附加到Camera2D）
├── GameUI.gd/tscn         # UI系统
├── PauseMenu.gd/tscn      # 暂停菜单系统
├── WallGenerator.gd       # 墙体生成工具（编辑器脚本）
└── assets/                # 游戏资源
	├── Tilesheet/         # 瓦片图集
	└── [角色文件夹]/      # 角色精灵图
```

## 开发命令

```bash
# 打开编辑器
godot --editor .

# 运行游戏
godot .
```

## 待扩展功能建议

- [ ] 武器系统（多种武器）
- [ ] 音效系统（射击、受伤、死亡音效）
- [ ] 道具系统（生命包、弹药）
- [ ] 波次系统（难度递增）
- [x] 暂停菜单 ✅ 已完成
- [ ] 最高分记录
- [ ] 多种敌人类型
- [ ] 玩家升级系统
